(function(e){function t(t){for(var a,i,s=t[0],c=t[1],u=t[2],h=0,f=[];h<s.length;h++)i=s[h],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&f.push(n[i][0]),n[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);l&&l(t);while(f.length)f.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],a=!0,s=1;s<r.length;s++){var c=r[s];0!==n[c]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var a={},n={app:0},o=[];function i(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=a,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/vue-mapbox-h3-spike/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var a=r("85ec"),n=r.n(a);n.a},5490:function(e,t,r){"use strict";var a=r("a6b6"),n=r.n(a);n.a},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("Map")],1)},o=[],i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{fluid:"",id:"map-container"}},[r("b-row",{attrs:{id:"map-row"}},[r("b-col",{attrs:{cols:"12",md:"10",id:"map-col"}},[r("MglMap",{attrs:{accessToken:e.accessToken,mapStyle:e.mapStyle,center:[e.config.lng,e.config.lat],zoom:e.config.zoom},on:{"update:mapStyle":function(t){e.mapStyle=t},"update:map-style":function(t){e.mapStyle=t},load:e.onMapLoaded}})],1),r("b-col",{attrs:{cols:"12",md:"2",id:"sliders"}},[r("p",[e._v("Crime Weight: "+e._s(e.crimeWeight))]),r("input",{attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:e.crimeWeight},on:{input:function(t){return e.onSliderChange(t,"crime")}}}),r("p",[e._v("Dog Park Weight: "+e._s(e.dogParkWeight))]),r("input",{attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:e.dogParkWeight},on:{input:function(t){return e.onSliderChange(t,"dogParks")}}}),r("p",[e._v("Marta Weight: "+e._s(e.martaWeight))]),r("input",{attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:e.martaWeight},on:{input:function(t){return e.onSliderChange(t,"marta")}}}),r("p",[e._v("Travel Time Weight: "+e._s(e.travelWeight))]),r("input",{attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:e.travelWeight},on:{input:function(t){return e.onSliderChange(t,"travelTime")}}})])],1)],1)},s=[],c=(r("4de4"),r("4160"),r("d81d"),r("13d5"),r("a9e3"),r("b64b"),r("d3b7"),r("159b"),r("3835")),u=(r("96cf"),r("1da1")),l=r("e192"),h=r.n(l),f=r("b2e9"),g=r("369b");function d(e){var t=g.parse(e,{header:!0}),r=t.data;return{type:"FeatureCollection",features:Object.keys(r).map((function(e){return{type:"Feature",id:r[e].stop_id,properties:{stop_id:r[e].stop_id,stop_name:r[e].stop_name},geometry:{type:"Point",coordinates:[parseFloat(r[e].stop_lon),parseFloat(r[e].stop_lat)]}}}))}}var p=r("3f3d"),m=r("369b"),y={components:{MglMap:p["a"]},data:function(){return{accessToken:"pk.eyJ1IjoiY2xqMDAyMCIsImEiOiJjam80b2Y4cmEwMWFrM3ZwNW9wbzZvNjF0In0.tGdbiR2A0B9bbHXo_Hg93w",mapStyle:"mapbox://styles/mapbox/streets-v11",config:{lng:-84.387595,lat:33.746605,zoom:11,fillOpacity:.9,colorScale:["#ffffD9","#50BAC3","#1A468A"],areaThreshold:.75},h3Resolution:8,crimeLayer:null,crime90days:null,crimeWeight:1,dogParksLayer:null,dogParks:null,dogParkWeight:1,travelTimeLayer:null,travelTimes:null,travelWeight:1,martaLayer:null,martaStations:null,martaWeight:1}},created:function(){this.mapbox=h.a,this.map=null},methods:{onMapLoaded:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.map=e.map,r.next=3,t.seedData();case 3:a=r.sent,console.log(a),t.displayData(t.map);case 6:case"end":return r.stop()}}),r)})))()},displayData:function(e){console.log("Displaying data."),this.createLayers();var t=[{name:"crime",hexagons:this.crimeLayer,weight:-this.crimeWeight},{name:"dogParks",hexagons:this.dogParksLayer,weight:this.dogParkWeight},{name:"marta",hexagons:this.martaLayer,weight:this.martaWeight},{name:"traveltime",hexagons:this.travelTimeLayer,weight:this.travelWeight}],r=this.combineLayers(t);this.renderHexes(e,r)},onSliderChange:function(e,t){"crime"==t?this.crimeWeight=Number(e.target.value):"dogParks"==t?this.dogParkWeight=Number(e.target.value):"marta"==t?this.martaWeight=Number(e.target.value):"travelTime"==t&&(this.travelWeight=Number(e.target.value)),console.log("Slider change",t),this.redistributeWeights()},redistributeWeights:function(){console.log("Redistributing weights");var e=[{name:"crime",hexagons:this.crimeLayer,weight:-this.crimeWeight},{name:"dogParks",hexagons:this.dogParksLayer,weight:this.dogParkWeight},{name:"marta",hexagons:this.martaLayer,weight:this.martaWeight},{name:"traveltime",hexagons:this.travelTimeLayer,weight:this.travelWeight}];console.log("Map layers",e);var t=this.combineLayers(e);this.renderHexes(this.map,t)},combineLayers:function(e){var t={};return e.forEach((function(e){var r=e.hexagons,a=e.weight;Object.keys(r).forEach((function(e){t[e]=(t[e]||0)+r[e]*a}))})),this.normalizeLayer(t)},createLayers:function(){console.log("Creating layers"),this.crimeLayer=this.createCrimeLayer(),this.dogParksLayer=this.createDogParksLayer(),this.martaLayer=this.createMartaLayer(),this.travelTimeLayer=this.createTravelTimeLayer()},createCrimeLayer:function(){var e=this;console.log("Creating crime layer",this.crime90days);var t={};return this.crime90days.forEach((function(r){var a=r.lat,n=r.lng,o=e.$geoToH3(a,n,Number(e.h3Resolution));t[o]=(t[o]||0)+1})),this.normalizeLayer(t)},createDogParksLayer:function(){return console.log("Creating dog parks layer",this.dogParks),this.normalizeLayer(this.bufferPointLinear(this.martaStations,this.kmToRadius(1)))},createMartaLayer:function(){return console.log("Creating marta layer",this.martaStations),this.normalizeLayer(this.bufferPointLinear(this.martaStations,this.kmToRadius(1)))},createTravelTimeLayer:function(){var e=this;console.log("Creating travel time layer",this.travelTimes);var t={};return this.travelTimes.features.forEach((function(r){var a=e.$geojson2h3.featureToH3Set(r,Number(e.h3Resolution));a.forEach((function(e){t[e]=(t[e]||0)+1/r.properties.travelTime}))})),this.normalizeLayer(t,!0)},createPointsOfInterestLayer:function(){var e=this;console.log("Creating poi layer",this.pointsOfInterest);var t={};return this.pointsOfInterest.filter((function(e){return"Cafes"===e.type||"Places to Eat"===e.type||"Restaurant"===e.type})).forEach((function(r){var a=r.lat,n=r.lng,o=e.$geoToH3(a,n,Number(e.h3Resolution));t[o]=(t[o]||0)+1})),this.normalizeLayer(t)},seedData:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Seeding data"),t.next=3,e.seedCrimeData();case 3:return e.crime90days=t.sent,console.log("Crimes",e.crime90days),t.next=7,e.seedDogParkLocations();case 7:return e.dogParks=t.sent,console.log("Dog Parks",e.dogParks),t.next=11,e.seedMartaStations();case 11:return e.martaStations=t.sent,console.log("Marta stations",e.martaStations),t.next=15,e.seedTravelTimes();case 15:return e.travelTimes=t.sent,console.log("Travel Times",e.travelTimes),t.abrupt("return","Seeded");case 18:case"end":return t.stop()}}),t)})))()},seedTravelTimes:function(){return Object(f["a"])("./travelTimes.json")},seedMartaStations:function(){return Object(f["b"])("./martaStops.txt").then((function(e){return d(e)}))},seedCrimeData:function(){return console.log("Seeding crime data"),new Promise((function(e){m.parse("https://query.data.world/s/3lnfl7oqpk3fspbleodbcu4wt4hwq5",{download:!0,header:!0,complete:function(t){var r=t.data,a=Object.keys(r).map((function(e){return{lat:r[e].lat,lng:r[e].long,type:r[e].crime}}));e(a)}})}))},seedDogParkLocations:function(){return Object(f["a"])("./dogParks.json")},seedPointsOfInterest:function(){return Object(f["a"])("https://gist.githubusercontent.com/nrabinowitz/d3a5ca3e3e40727595dd137b65058c76/raw/ded89c2acef426fe3ee59b05096ed1baecf02090/oakland-poi.json")},renderHexes:function(e,t){var r=this.$geojson2h3.h3SetToFeatureCollection(Object.keys(t),(function(e){return{value:t[e]}})),a="h3-hexes",n="".concat(a,"-layer"),o=e.getSource(a);if(!o){var i={id:n,source:a,type:"fill",interactive:!1,paint:{"fill-outline-color":"rgba(0,0,0,0)"}};e.addSource(a,{type:"geojson",data:r}),e.addLayer(i),o=e.getSource(a)}o.setData(r),e.setPaintProperty(n,"fill-color",{property:"value",stops:[[0,this.config.colorScale[0]],[.5,this.config.colorScale[1]],[1,this.config.colorScale[2]]]}),e.setPaintProperty(n,"fill-opacity",this.config.fillOpacity)},renderAreas:function(e,t){var r=this,a=this.$geojson2h3.h3SetToFeature(Object.keys(t).filter((function(e){return t[e]>r.config.areaThreshold}))),n="h3-hex-areas",o="".concat(n,"-layer"),i=e.getSource(n);i||(e.addSource(n,{type:"geojson",data:a}),e.addLayer({id:o,source:n,type:"line",interactive:!1,paint:{"line-width":3,"line-color":this.config.colorScale[2]}}),i=e.getSource(n)),i.setData(a)},countPoints:function(e){var t=this,r={};return e.features.forEach((function(e){var a=Object(c["a"])(e.geometry.coordinates,2),n=a[0],o=a[1],i=t.$geoToH3(o,n,Number(t.h3Resolution));r[i]=(r[i]||0)+1})),this.normalizeLayer(r,!0)},bufferPoints:function(e,t){var r=this,a={};return e.features.forEach((function(e){var n=Object(c["a"])(e.geometry.coordinates,2),o=n[0],i=n[1],s=r.$geoToH3(i,o,Number(r.h3Resolution)),u=r.$kRing(s,t);u.forEach((function(e){a[e]=(a[e]||0)+1}))})),this.normalizeLayer(a,!0)},bufferPointLinear:function(e,t){var r=this,a={};return e.features.forEach((function(e){var n=Object(c["a"])(e.geometry.coordinates,2),o=n[0],i=n[1],s=r.$geoToH3(i,o,Number(r.h3Resolution)),u=r.$kRingDistances(s,t),l=1/(t+1);u.forEach((function(e,t){e.forEach((function(e){a[e]=(a[e]||0)+1-t*l}))}))})),this.normalizeLayer(a)},normalizeLayer:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Object.keys(e),a=r.reduce((function(t,r){return Math.max(t,e[r])}),-1/0),n=t?r.reduce((function(t,r){return Math.min(t,e[r])}),1/0):0;return r.forEach((function(t){e[t]=(e[t]-n)/(a-n)})),e},kmToRadius:function(e){return Math.floor(e/this.$edgeLength(Number(this.h3Resolution),this.$UNITS.km))}}},v=y,b=(r("5490"),r("2877")),P=Object(b["a"])(v,i,s,!1,null,null,null),k=P.exports,L={name:"App",components:{Map:k}},T=L,S=(r("034f"),Object(b["a"])(T,n,o,!1,null,null,null)),j=S.exports,x=r("20cd"),O=r.n(x),w=r("f75e"),W=r("5f5b");r("f9e3");Object.defineProperty(a["default"].prototype,"$geojson2h3",{value:O.a}),Object.defineProperty(a["default"].prototype,"$geoToH3",{value:w["geoToH3"]}),Object.defineProperty(a["default"].prototype,"$hexRing",{value:w["hexRing"]}),Object.defineProperty(a["default"].prototype,"$kRing",{value:w["kRing"]}),Object.defineProperty(a["default"].prototype,"$kRingDistances",{value:w["kRingDistances"]}),Object.defineProperty(a["default"].prototype,"$edgeLength",{value:w["edgeLength"]}),Object.defineProperty(a["default"].prototype,"$UNITS",{value:w["UNITS"]}),a["default"].config.productionTip=!1,a["default"].use(W["a"]),new a["default"]({render:function(e){return e(j)}}).$mount("#app")},"85ec":function(e,t,r){},a6b6:function(e,t,r){}});
//# sourceMappingURL=app.a547aa55.js.map